<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản lý Dịch vụ</title>
    <style>
        body{font-family:Arial, sans-serif;padding:24px;background:#f6f8fa}
        table{width:100%;border-collapse:collapse;background:#fff}
        th,td{padding:8px;border-bottom:1px solid #eee}
        .actions button{margin-right:6px}
        form.inline{display:flex;gap:8px;align-items:center}
    </style>
</head>
<body>
<!-- admin navbar fragment -->
<div id="adminNavPlaceholder"></div>
<script>fetch('/fragments/admin-navbar.html').then(r=>r.text()).then(t=>{ document.getElementById('adminNavPlaceholder').innerHTML = t; }).catch(()=>{});</script>

<h1>Quản lý Dịch vụ</h1>
<a href="/admin">← Dashboard</a>
<section style="margin-top:12px">
    <h3>Thêm dịch vụ mới</h3>
    <form id="createForm">
        <label for="svcName">Tên dịch vụ</label>
        <input id="svcName" name="name" placeholder="Tên dịch vụ" required>

        <label for="svcPrice">Giá (VND)</label>
        <input id="svcPrice" name="price" type="number" step="0.01" min="0" placeholder="Giá (bắt buộc)" required>

        <label for="svcDuration">Thời lượng (phút)</label>
        <input id="svcDuration" name="durationMinutes" type="number" min="1" placeholder="Thời lượng (phút) (bắt buộc)" required>

        <label for="svcDesc">Mô tả</label>
        <input id="svcDesc" name="description" placeholder="Mô tả (tuỳ chọn)">

        <button type="submit">Tạo</button>
    </form>
</section>
<section style="margin-top:16px">
    <h3>Danh sách</h3>
    <table id="servicesTable">
        <thead><tr><th>ID</th><th>Tên</th><th>Hành động</th></tr></thead>
        <tbody><tr><td colspan="3">Đang tải...</td></tr></tbody>
    </table>
</section>
<script>
async function loadServices(){
    const resp = await fetch('/api/services', { credentials: 'same-origin' });
    const json = await resp.json();
    const list = json.data || [];
    const tbody = document.querySelector('#servicesTable tbody');
    if(!Array.isArray(list)||list.length===0){tbody.innerHTML='<tr><td colspan="3">Không có dịch vụ</td></tr>';return}
    tbody.innerHTML = list.map(s=>`<tr><td>${s.id}</td><td>${s.name||s.title||''}</td><td class="actions"><button data-id="${s.id}" class="delete">Xóa</button></td></tr>`).join('');
    document.querySelectorAll('.delete').forEach(btn=>btn.onclick=async ()=>{
        const id=btn.dataset.id;
        if(!confirm('Xác nhận xóa?')) return;
        const r = await fetch('/api/services/'+id,{method:'DELETE', credentials: 'same-origin'});
        const jr = await r.json();
        alert(jr.message||JSON.stringify(jr));
        loadServices();
    });
}

document.getElementById('createForm').onsubmit = async function(e){
    e.preventDefault();
    const fd = new FormData(this);
    const payload = {
      name: fd.get('name'),
      price: fd.get('price') ? Number(fd.get('price')) : null,
      durationMinutes: fd.get('durationMinutes') ? Number(fd.get('durationMinutes')) : null,
      description: fd.get('description') || null
    };
    if(payload.price == null || payload.durationMinutes == null){ alert('Vui lòng nhập giá và thời lượng (phút).'); return; }
    const r = await fetch('/api/services',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload), credentials: 'same-origin'});
    const jr = await r.json();
    alert(jr.message||JSON.stringify(jr));
    loadServices();
}

loadServices();
</script>
</body>
</html>
